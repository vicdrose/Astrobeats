<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Astro Beats App</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 20px;
    background: #111;
    color: #fff;
  }
  #cardsContainer {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
    justify-content: center;
    flex-direction: row-reverse; /* initial row order fix */
  }
  .card {
    width: 200px;
    height: 300px;
    perspective: 1000px;
    border-radius: 15px;
    overflow: hidden;
    position: relative;
  }
  .card img {
    width: 100%;
    height: 100%;
    border-radius: 15px;
    transition: transform 0.6s;
    display: block;
  }
  .card.flipped img {
    transform: rotateY(180deg);
  }

  #journal {
    margin-top: 40px;
  }
  #journal textarea {
    width: 100%;
    height: 100px;
    border-radius: 10px;
    padding: 10px;
    font-size: 16px;
  }
  #journal button {
    margin-top: 10px;
    padding: 10px 20px;
    font-size: 16px;
    cursor: pointer;
  }
  #journalEntries {
    margin-top: 20px;
  }
  .entry {
    margin-bottom: 10px;
    padding: 10px;
    background: #222;
    border-radius: 10px;
  }
</style>
</head>
<body>

<h1>Astro Beats App</h1>
<div id="cardsContainer">
  <div id="card1" class="card"></div>
  <div id="card2" class="card"></div>
  <div id="card3" class="card"></div>
  <div id="card4" class="card"></div>
</div>

<button id="shuffleBtn">Shuffle Cards</button>

<div id="journal">
  <textarea id="journalInput" placeholder="Write your journal entry..."></textarea>
  <button id="saveJournalBtn">Save Entry</button>
  <div id="journalEntries"></div>
</div>

<script>
let astroData;

// Load JSON data
fetch("data.json")
  .then(res => res.json())
  .then(data => {
    astroData = data;
    populateCards();
    loadJournal();
  })
  .catch(err => console.error("Failed to load JSON:", err));

function populateCards() {
  if (!astroData) return;

  // pick random items
  const crystalKeys = Object.keys(astroData.crystals.front);
  const crystalRandom = crystalKeys[Math.floor(Math.random() * crystalKeys.length)];
  const crystalFront = astroData.crystals.front[crystalRandom];
  const crystalBack = astroData.crystals.text[crystalRandom];

  const bodyKeys = Object.keys(astroData.astrology.body);
  const bodyRandom = bodyKeys[Math.floor(Math.random() * bodyKeys.length)];
  const bodyImg = astroData.astrology.body[bodyRandom];

  const houseKeys = Object.keys(astroData.astrology.houses);
  const houseRandom = houseKeys[Math.floor(Math.random() * houseKeys.length)];
  const houseImg = astroData.astrology.houses[houseRandom];

  const signKeys = Object.keys(astroData.astrology.sign);
  const signRandom = signKeys[Math.floor(Math.random() * signKeys.length)];
  const signImg = astroData.astrology.sign[signRandom];

  const cardArr = [
    { el: document.querySelector("#card1"), front: crystalFront, back: crystalBack },
    { el: document.querySelector("#card2"), front: bodyImg, back: astroData.astrology.back },
    { el: document.querySelector("#card3"), front: houseImg, back: astroData.astrology.back },
    { el: document.querySelector("#card4"), front: signImg, back: astroData.astrology.back },
  ];

  cardArr.forEach(card => {
    card.el.innerHTML = `<img src="${card.back}" data-front="${card.front}" data-back="${card.back}">`;
    card.el.classList.remove("flipped");
  });

  setupFlipEvents();
}

function setupFlipEvents() {
  const cards = document.querySelectorAll(".card img");
  cards.forEach(img => {
    img.parentElement.addEventListener("click", () => {
      const parent = img.parentElement;
      parent.classList.toggle("flipped");
      img.src = parent.classList.contains("flipped") ? img.dataset.front : img.dataset.back;
    });
  });
}

// Shuffle button resets cards
document.getElementById("shuffleBtn").addEventListener("click", populateCards);

// --- Journal CRUD ---
function loadJournal() {
  const entries = JSON.parse(localStorage.getItem("journalEntries") || "[]");
  renderJournal(entries);
}

function renderJournal(entries) {
  const container = document.getElementById("journalEntries");
  container.innerHTML = "";
  entries.forEach((entry, idx) => {
    const div = document.createElement("div");
    div.className = "entry";
    div.innerHTML = `
      <p>${entry}</p>
      <button onclick="deleteEntry(${idx})">Delete</button>
    `;
    container.appendChild(div);
  });
}

document.getElementById("saveJournalBtn").addEventListener("click", () => {
  const input = document.getElementById("journalInput");
  if (!input.value) return;
  const entries = JSON.parse(localStorage.getItem("journalEntries") || "[]");
  entries.push(input.value);
  localStorage.setItem("journalEntries", JSON.stringify(entries));
  input.value = "";
  renderJournal(entries);
});

function deleteEntry(idx) {
  const entries = JSON.parse(localStorage.getItem("journalEntries") || "[]");
  entries.splice(idx, 1);
  localStorage.setItem("journalEntries", JSON.stringify(entries));
  renderJournal(entries);
}
</script>
</body>
</html>